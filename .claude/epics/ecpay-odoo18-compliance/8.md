---
name: Full Integration Testing with Playwright
status: open
created: 2026-01-07T01:34:46Z
updated: 2026-01-07T01:45:08Z
github: https://github.com/WOOWTECH/ecpay_odoo18/issues/8
depends_on: [2, 3, 4, 5, 6, 7]
parallel: false
conflicts_with: []
---

# Task: Full Integration Testing with Playwright

## Description

Perform comprehensive integration testing of all ECPay modules using Playwright MCP in headed mode. This task verifies all bug fixes and new functionality work correctly in the live Odoo 18 test instance.

**Test Instance:** https://matt-test-254-odoo.woowtech.io/
**Credentials:** admin / admin
**Tool:** Playwright MCP (headed mode)

## Acceptance Criteria

- [ ] All 11 bugs verified as fixed
- [ ] Settings page loads without error (BUG-007)
- [ ] All invoice form fields are editable (BUG-001, 002, 010, 011, 013)
- [ ] Checkout input fields work correctly
- [ ] Python compliance fixes don't cause regressions (BUG-008, 009, 012, 015)
- [ ] JavaScript dialogs work on website (BUG-014)
- [ ] Complete checkout-to-invoice flow succeeds
- [ ] ECPay API integration works (if sandbox available)

## Test Scenarios

### Scenario 1: Settings Page (BUG-007)

```gherkin
Given I am logged in as admin
When I navigate to Invoicing > Configuration > Settings
Then the page should load without error
And I should see ECPay configuration section
And all ECPay settings should be accessible
```

### Scenario 2: Invoice Form Fields (BUG-001, 002, 010, 011, 013)

```gherkin
Given I am logged in as admin
And I create a new customer invoice
When I select carrier type "Mobile Barcode"
Then I should be able to enter a carrier number

When I check "Donation" checkbox
Then is_donation should toggle to True
And I should be able to enter a lovecode

When I check "Print" checkbox
Then is_print should toggle to True
And I should be able to enter print address and name

When I enter customer identifier
Then the field should accept the value

When I save the invoice
Then all values should persist correctly
```

### Scenario 3: Website Checkout Flow

```gherkin
Given I am on the website shop
And I add a product to cart
And I proceed to checkout
When I select e-invoice type
And I select carrier type "Mobile Barcode"
Then carrier number input field should appear

When I enter carrier number "/ABC+123"
And I complete checkout
Then the sale order should have carrier number saved
And the invoice should have carrier number populated
```

### Scenario 4: Donation Flow

```gherkin
Given I am on checkout
When I select "Donation" for e-invoice
Then lovecode input should appear

When I enter lovecode "25885"
And I complete checkout
Then donation code should be saved to invoice
```

### Scenario 5: Error Handling (BUG-014)

```gherkin
Given I am on checkout
When I enter invalid carrier number "INVALID"
And I try to proceed
Then an error dialog should appear
And the error message should be readable
And the dialog should be dismissible
```

### Scenario 6: ECPay Invoice Issuance (if sandbox available)

```gherkin
Given I have a confirmed invoice with carrier number
When I click "Issue ECPay Invoice"
Then the API call should succeed
And invoice number should be returned
And invoice status should update to "Issued"
```

## Playwright Test Script Outline

```javascript
// test_ecpay_integration.js
const { test, expect } = require('@playwright/test');

test.describe('ECPay Integration Tests', () => {
    const BASE_URL = 'https://matt-test-254-odoo.woowtech.io';

    test.beforeEach(async ({ page }) => {
        // Login
        await page.goto(`${BASE_URL}/web/login`);
        await page.fill('input[name="login"]', 'admin');
        await page.fill('input[name="password"]', 'admin');
        await page.click('button[type="submit"]');
        await page.waitForURL('**/web**');
    });

    test('Settings page loads without error', async ({ page }) => {
        await page.goto(`${BASE_URL}/web#action=account_settings`);
        // Verify no error modal
        await expect(page.locator('.o_error_dialog')).not.toBeVisible();
        // Verify ECPay section exists
        await expect(page.locator('text=ECPay')).toBeVisible();
    });

    test('Invoice form fields are editable', async ({ page }) => {
        // Navigate to create invoice
        await page.goto(`${BASE_URL}/web#action=account.action_move_out_invoice_type`);
        await page.click('button:has-text("New")');

        // Test carrier number field
        await page.selectOption('[name="carrierType"]', '3');
        await page.fill('[name="input_carrier_num"]', '/ABC+123');
        await expect(page.locator('[name="input_carrier_num"]')).toHaveValue('/ABC+123');

        // Test donation toggle
        await page.check('[name="is_donation"]');
        await expect(page.locator('[name="is_donation"]')).toBeChecked();

        // Test lovecode field
        await page.fill('[name="lovecode"]', '25885');
        await expect(page.locator('[name="lovecode"]')).toHaveValue('25885');
    });

    test('Website checkout with carrier number', async ({ page }) => {
        // Go to shop
        await page.goto(`${BASE_URL}/shop`);
        // Add product to cart
        await page.click('.oe_product_cart:first-child a:has-text("Add to Cart")');
        // Proceed to checkout
        await page.goto(`${BASE_URL}/shop/checkout`);

        // Select e-invoice options
        await page.selectOption('[name="eCarrierType"]', '3');
        await expect(page.locator('.carrier_num_input')).toBeVisible();
        await page.fill('[name="carrier_num"]', '/ABC+123');

        // Verify data saves (check network request or page state)
    });
});
```

## Test Environment Setup

### Prerequisites
- Odoo 18 test instance running
- ECPay modules installed and enabled
- Test products in shop
- Playwright MCP configured for headed mode

### Test Data
- Admin credentials: admin / admin
- Test carrier numbers:
  - Mobile barcode: `/ABC+123`
  - Natural person: `AB12345678901234`
- Test lovecodes: `25885`, `919`, `8585`

## Bug Verification Checklist

| Bug | Test Scenario | Expected Result | Status |
|-----|---------------|-----------------|--------|
| BUG-007 | Settings page | Loads without KeyError | ⬜ |
| BUG-001 | Invoice form | Carrier number editable | ⬜ |
| BUG-002 | Invoice form | Donation/print toggleable | ⬜ |
| BUG-008 | Server logs | No compute warnings | ⬜ |
| BUG-009 | Server logs | No boolean comparison issues | ⬜ |
| BUG-010 | Invoice form | Related field writable | ⬜ |
| BUG-011 | Invoice form | is_donation/is_print work | ⬜ |
| BUG-012 | Payment flow | Type comparisons work | ⬜ |
| BUG-013 | Invoice form | All fields writable | ⬜ |
| BUG-014 | Website checkout | Error dialogs show | ⬜ |
| BUG-015 | Server logs | No recordset warnings | ⬜ |

## Dependencies

- [ ] All previous tasks (001-006) must be completed
- [ ] Test instance must be accessible
- [ ] Playwright MCP must be configured

## Effort Estimate

- Size: L
- Hours: 6-8
- Parallel: false (final verification task)

## Definition of Done

- [ ] All test scenarios executed
- [ ] All 11 bugs verified as fixed
- [ ] Screenshots captured for documentation
- [ ] Test results documented
- [ ] No regressions found
- [ ] Ready for production deployment
