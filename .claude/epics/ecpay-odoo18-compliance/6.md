---
name: JavaScript Compliance Fixes
status: open
created: 2026-01-07T01:34:46Z
updated: 2026-01-07T01:45:08Z
github: https://github.com/WOOWTECH/ecpay_odoo18/issues/6
depends_on: [4]
parallel: true
conflicts_with: []
---

# Task: JavaScript Compliance Fixes

## Description

Fix JavaScript code patterns that don't comply with Odoo 18 standards. The primary issue is the ConfirmationDialog usage in frontend context which may fail.

**Bug ID:** BUG-014
**Severity:** Medium
**Module:** ecpay_invoice_website

## Bugs Addressed

| Bug | Issue | Fix |
|-----|-------|-----|
| BUG-014 | ConfirmationDialog may fail in frontend context | Use appropriate dialog for website context |

## Acceptance Criteria

- [ ] Error dialogs display correctly on website pages
- [ ] Confirmation dialogs work in checkout flow
- [ ] No JavaScript errors in browser console
- [ ] Dialogs are styled consistently with website theme
- [ ] Mobile-friendly dialog display

## Technical Details

### BUG-014: ConfirmationDialog in Frontend

**Problem:**
The `ConfirmationDialog` service from `@web/core/confirmation_dialog/confirmation_dialog` is designed for the backend (web client) context. Using it on website pages may fail because the required services aren't available.

**Location:** `ecpay_invoice_website/static/src/js/invoice.js`

**Current Code (potentially problematic):**
```javascript
import { ConfirmationDialog } from "@web/core/confirmation_dialog/confirmation_dialog";

// This may fail on website pages
this.dialog.add(ConfirmationDialog, {
    title: "Error",
    body: "Something went wrong",
});
```

**Fix Options:**

**Option A: Use Bootstrap Modal (Recommended for Website)**
```javascript
// Use Bootstrap modal which is available on all pages
showError(message) {
    const $modal = $(`
        <div class="modal fade" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Error</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>${message}</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
                    </div>
                </div>
            </div>
        </div>
    `);
    $modal.modal('show');
}
```

**Option B: Check Context Before Using Dialog**
```javascript
import { registry } from "@web/core/registry";

showError(message) {
    // Check if we're in backend context
    const dialogService = registry.category("services").get("dialog", false);
    if (dialogService) {
        // Backend context - use ConfirmationDialog
        this.dialog.add(ConfirmationDialog, { body: message });
    } else {
        // Frontend context - use alert or Bootstrap modal
        alert(message);
    }
}
```

**Option C: Use Odoo's Website Dialog Service**
```javascript
import { useService } from "@web/core/utils/hooks";

setup() {
    this.notification = useService("notification");
}

showError(message) {
    this.notification.add(message, { type: "danger" });
}
```

### Files to Modify

- `ecpay_invoice_website/static/src/js/invoice.js`
- Potentially: `ecpay_invoice_website/static/src/xml/invoice_templates.xml`

### Odoo 18 JavaScript Patterns

1. **Module declaration:** `/** @odoo-module **/`
2. **Imports:** Use `@web/` path prefix
3. **Service usage:** `useService()` hook in setup
4. **Super binding:** Proper `super()` calls

## Dependencies

- [ ] Task 003 (Checkout input fields should be in place)

## Bug Resolution Process (MANDATORY)

### Step 1: Deep Research
- [ ] Review current invoice.js implementation
- [ ] Test ConfirmationDialog on website page
- [ ] Identify which dialog approach works best
- [ ] Check Odoo 18 website module patterns

### Step 2: Create Fix Plan
- [ ] Choose dialog implementation approach
- [ ] List exact code changes
- [ ] Plan error handling flow

### Step 3: Review Fix Plan
- [ ] Dialog works in both backend and frontend
- [ ] Mobile-responsive
- [ ] Consistent styling

### Step 4: Implement Fix
- [ ] Apply dialog fix
- [ ] Test in browser console for errors
- [ ] Commit with BUG-014 reference

### Step 5: Deploy Test (Playwright MCP - Headed)
- [ ] Navigate to https://matt-test-254-odoo.woowtech.io/shop
- [ ] Proceed to checkout
- [ ] Trigger validation error (e.g., invalid carrier number)
- [ ] Verify error dialog displays correctly
- [ ] Check browser console for JS errors
- [ ] Test on mobile viewport
- [ ] Capture screenshots

### Step 6: Verify or Rollback
- [ ] If PASS: Mark task complete
- [ ] If FAIL: `git revert HEAD` and return to Step 1

## Effort Estimate

- Size: S
- Hours: 2-3
- Parallel: true (can run alongside Task 004)

## Definition of Done

- [ ] Error dialogs display correctly on website
- [ ] No JavaScript console errors
- [ ] Mobile-responsive dialogs
- [ ] Tested on live instance
- [ ] Code committed
