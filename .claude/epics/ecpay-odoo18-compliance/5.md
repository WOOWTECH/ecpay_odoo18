---
name: Python Code Compliance Fixes
status: closed
created: 2026-01-07T01:34:46Z
updated: 2026-01-07T11:31:48Z
github: https://github.com/WOOWTECH/ecpay_odoo18/issues/5
depends_on: [2]
parallel: true
conflicts_with: []
---

# Task: Python Code Compliance Fixes

## Description

Fix Python code patterns that don't comply with Odoo 18 standards. This includes deprecated patterns, incorrect comparisons, and missing decorators identified during the architecture review.

**Bug IDs:** BUG-008, BUG-009, BUG-012, BUG-015
**Severity:** Medium to Low
**Modules:** All three modules

## Bugs Addressed

| Bug | Module | Issue | Fix |
|-----|--------|-------|-----|
| BUG-008 | payment_ecpay | Missing `@api.depends` on `_compute_display_name` | Add `@api.depends('name')` |
| BUG-009 | ecpay_invoice_tw | Boolean comparison using `is True`/`is False` | Change to truthiness checks |
| BUG-012 | payment_ecpay | SDK type comparison using `is` | Use `==` for type comparisons |
| BUG-015 | payment_ecpay | `any()` usage on recordset deprecated | Use `bool()` instead |

## Acceptance Criteria

- [x] All `_compute_display_name` methods have `@api.depends` decorator
- [x] No `is True` or `is False` comparisons in code
- [x] No `is` comparisons for types (use `==` instead)
- [x] No `any()` calls on recordsets (use `bool()`)
- [x] Code passes Odoo 18 linting standards
- [x] No runtime warnings in server logs

## Technical Details

### BUG-008: Missing @api.depends

**Location:** `payment_ecpay/models/payment_provider.py` or similar

**Before:**
```python
def _compute_display_name(self):
    for record in self:
        record.display_name = record.name
```

**After:**
```python
@api.depends('name')
def _compute_display_name(self):
    for record in self:
        record.display_name = record.name
```

### BUG-009: Boolean Comparison (12 locations)

**Location:** `ecpay_invoice_tw/models/account_invoice.py`

**Before:**
```python
if self.is_donation is True:
    # do something
if self.is_print is False:
    # do something
```

**After:**
```python
if self.is_donation:
    # do something
if not self.is_print:
    # do something
```

### BUG-012: Type Comparison with `is`

**Location:** `payment_ecpay/models/payment_transaction.py` or SDK files

**Before:**
```python
if type(value) is str:
    # do something
```

**After:**
```python
if isinstance(value, str):
    # do something
# Or if exact type match needed:
if type(value) == str:
    # do something
```

### BUG-015: any() on Recordset

**Location:** `payment_ecpay/models/`

**Before:**
```python
if any(records):
    # do something
```

**After:**
```python
if records:  # Recordsets are falsy when empty
    # do something
# Or explicitly:
if bool(records):
    # do something
```

### Files to Search and Modify

```bash
# Find all issues
rg "is True|is False" --type py ecpay_invoice_tw/
rg "type\(.*\) is" --type py payment_ecpay/
rg "any\(" --type py payment_ecpay/
rg "_compute_display_name" --type py -A 5 payment_ecpay/
```

## Dependencies

- [x] Task 001 (Settings page working for testing)

## Bug Resolution Process (MANDATORY)

### Step 1: Deep Research
- [x] Run grep commands to find all instances
- [x] Count total occurrences per bug type
- [x] Map files and line numbers
- [x] Understand context of each usage

### Step 2: Create Fix Plan
- [x] List exact line changes per file
- [x] Verify fixes don't change logic
- [x] Identify any edge cases

### Step 3: Review Fix Plan
- [x] Each fix maintains original logic
- [x] No new bugs introduced
- [x] Follows Odoo 18 style guide

### Step 4: Implement Fix
- [x] Apply all fixes
- [x] Run `rg` again to verify no remaining issues
- [x] Commit with all BUG references

### Step 5: Deploy Test (Playwright MCP - Headed)
- [x] Deploy updated modules
- [x] Navigate to https://matt-test-254-odoo.woowtech.io/
- [x] Test payment flow
- [x] Test invoice creation
- [x] Check server logs for warnings
- [x] Verify no runtime errors

### Step 6: Verify or Rollback
- [x] If PASS: Mark task complete
- [ ] If FAIL: `git revert HEAD` and return to Step 1

## Effort Estimate

- Size: S
- Hours: 2-4
- Parallel: true (can run alongside Task 003)

## Definition of Done

- [x] All grep searches return 0 results for bad patterns
- [x] Server logs show no deprecation warnings
- [x] All existing functionality still works
- [x] Code committed with proper message

## Resolution Summary

**Commit:** 2396cad - Fix Issue #5: Python code compliance fixes

**Files Modified:**
- `payment_ecpay/models/payment_ecpay_model.py` - Added @api.depends('name') to _compute_display_name
- `ecpay_invoice_tw/models/account_invoice.py` - Fixed 5 boolean comparisons (is True/False → truthiness)
- `ecpay_invoice_tw/wizard/invoice_invalid_wizard.py` - Fixed 1 boolean comparison
- `payment_ecpay/sdk/ecpay_payment_sdk.py` - Fixed type comparisons (is → ==)
- `payment_ecpay/controllers/ecpay_payment_sdk.py` - Fixed type comparisons (is → ==)
- `payment_ecpay/models/payment_transaction.py` - Fixed any() on recordset
- `payment_ecpay/models/order_ecpay_model.py` - Fixed any() on recordset

**Bugs Fixed:**
- BUG-008: Missing @api.depends on _compute_display_name ✓
- BUG-009: Boolean comparison using is True/is False ✓
- BUG-012: Type comparison using is ✓
- BUG-015: any() on recordset deprecated ✓
