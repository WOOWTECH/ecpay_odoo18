---
name: Fix Readonly Fields on Invoice Form
status: open
created: 2026-01-07T01:34:46Z
updated: 2026-01-07T01:45:08Z
github: https://github.com/WOOWTECH/ecpay_odoo18/issues/3
depends_on: [2]
parallel: false
conflicts_with: [4]
---

# Task: Fix Readonly Fields on Invoice Form

## Description

Fix multiple readonly fields on the invoice form that prevent users from entering e-invoice data. This task consolidates 5 related bugs that share the same root cause: fields defined as `readonly=True` or using readonly related fields that cannot accept user input.

**Bug IDs:** BUG-001, BUG-002, BUG-010, BUG-011, BUG-013
**Severity:** High
**Module:** ecpay_invoice_tw

## Bugs Addressed

| Bug | Field(s) | Issue |
|-----|----------|-------|
| BUG-001 | `carrierNum` | Cannot input carrier number |
| BUG-002 | `is_donation`, `is_print` | Cannot toggle donation/print options |
| BUG-010 | `carrierNum` (related field) | Related field cannot be written to |
| BUG-011 | `is_donation`, `is_print` | Same as BUG-002, different code path |
| BUG-013 | `lovecode`, `ecpay_CustomerIdentifier`, `ec_print_address`, `ec_ident_name` | Multiple readonly fields block data flow |

## Acceptance Criteria

- [ ] Carrier number field is editable when carrier type requires it (types 2, 3)
- [ ] Donation checkbox (`is_donation`) can be toggled
- [ ] Print checkbox (`is_print`) can be toggled
- [ ] Lovecode field is editable when donation is selected
- [ ] Customer Identifier field is editable
- [ ] Print address field is editable when print is selected
- [ ] Identification name field is editable
- [ ] Data saves correctly to database
- [ ] Data transmits correctly to ECPay API

## Technical Details

### Root Cause Analysis
Fields are defined with `readonly=True` attribute or as `related` fields pointing to readonly sources. In Odoo 18, readonly fields cannot receive values from web forms.

### Files to Modify
- `ecpay_invoice_tw/models/account_invoice.py`
- `ecpay_invoice_tw/views/account_invoice_form.xml`

### Fix Approach (per AD-1 in Epic)

**Option A: Add Input Fields (Recommended)**
```python
# Add new editable input fields
input_carrier_num = fields.Char(string='Carrier Number Input')
input_lovecode = fields.Char(string='Donation Code Input')

# Add onchange validation
@api.onchange('carrierType', 'input_carrier_num')
def _onchange_carrier_num(self):
    if self.carrierType in ['2', '3'] and self.input_carrier_num:
        # Validate format based on carrier type
        pass
```

**Option B: Remove Readonly Attribute**
```python
# Change from:
carrierNum = fields.Char(readonly=True)
# To:
carrierNum = fields.Char()  # Remove readonly

# For related fields, use store=True and remove readonly
```

### Odoo 18 Field Patterns
- Editable fields: `fields.Char(string='Name')`
- Conditionally readonly: Use `readonly` attribute in XML view with domain
- Related fields: Must have `store=True` to be editable, or use separate input field

## Dependencies

- [ ] Task 001 (Settings page must work to access invoice settings)

## Bug Resolution Process (MANDATORY)

### Step 1: Deep Research
- [ ] Read Odoo 18 field documentation
- [ ] Map all affected fields and their definitions
- [ ] Trace data flow from form to ECPay API
- [ ] Document current field hierarchy

### Step 2: Create Fix Plan
- [ ] Choose between Option A (new fields) or Option B (remove readonly)
- [ ] List exact field definition changes
- [ ] List XML view changes
- [ ] Define rollback strategy

### Step 3: Review Fix Plan
- [ ] Validate approach maintains backward compatibility
- [ ] Check data doesn't break existing invoices
- [ ] Confirm ECPay API integration unaffected

### Step 4: Implement Fix
- [ ] Modify field definitions in account_invoice.py
- [ ] Update XML views for conditional display
- [ ] Add onchange validation handlers
- [ ] Commit with BUG references

### Step 5: Deploy Test (Playwright MCP - Headed)
- [ ] Navigate to https://matt-test-254-odoo.woowtech.io/
- [ ] Login: admin / admin
- [ ] Create new invoice
- [ ] Test carrier number input for type 2 (Natural Person Barcode)
- [ ] Test carrier number input for type 3 (Mobile Barcode)
- [ ] Test donation checkbox and lovecode input
- [ ] Test print checkbox and address input
- [ ] Verify data saves correctly
- [ ] Capture screenshots

### Step 6: Verify or Rollback
- [ ] If PASS: Mark task complete
- [ ] If FAIL: `git revert HEAD` and return to Step 1

## Effort Estimate

- Size: M
- Hours: 4-6
- Parallel: false (depends on Task 001)

## Definition of Done

- [ ] All listed fields are editable in appropriate contexts
- [ ] Form validation works correctly
- [ ] Data persists to database
- [ ] ECPay API receives correct data
- [ ] Tested on live instance
- [ ] No regressions in existing functionality
