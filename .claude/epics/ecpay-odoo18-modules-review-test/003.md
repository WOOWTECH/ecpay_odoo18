---
name: Invoice Module - Basic Invoice Creation Tests
status: open
created: 2025-12-30T11:11:52Z
updated: 2025-12-30T11:11:52Z
github: [Will be updated when synced to GitHub]
depends_on: [002]
parallel: true
conflicts_with: [006]
---

# Task: Invoice Module - Basic Invoice Creation Tests

## Description
Test basic electronic invoice (電子發票) creation functionality including manual creation, automatic creation on post, and B2B invoice with business identifier (統一編號).

## Acceptance Criteria
- [ ] Manual B2C invoice creation works
- [ ] Automatic invoice creation on post works (if enabled)
- [ ] B2B invoice with 統一編號 works
- [ ] Invoice number received from ECPay
- [ ] Invoice status updates correctly (to invoice → invoiced)
- [ ] QR codes and barcode data retrieved
- [ ] Screenshots captured for each test

## Technical Details

### Test Case 1: Manual B2C Invoice Creation
1. Create a new Sales Order with test customer
2. Confirm order
3. Create invoice from order
4. Post the invoice
5. Click "Create E-Invoice" button (if manual mode)
6. Verify invoice number received
7. Verify uniform_state = 'invoiced'

### Test Case 2: Automatic Invoice Creation
1. Ensure company setting is "automatic"
2. Create Sales Order → Confirm → Create Invoice
3. Post the invoice
4. Verify e-invoice created automatically
5. Check for ECPay API response

### Test Case 3: B2B Invoice with Tax ID
1. Create customer with 統一編號 (e.g., 12345678)
2. Create Sales Order for this customer
3. Create and post invoice
4. Set ecpay_CustomerIdentifier
5. Create e-invoice
6. Verify IIS_Category = 'B2B'
7. Verify print flag is set

### ECPay API Endpoints Used
- `B2CInvoice/Issue` - Create invoice
- `B2CInvoice/GetIssue` - Query invoice details

### Expected Fields After Creation
- `ecpay_invoice_id` - Link to uniform.invoice record
- `uniform_state` - Should be 'invoiced'
- Invoice number (e.g., AB12345678)

## Dependencies
- [ ] Task 002: Modules installed and configured

## Effort Estimate
- Size: M
- Hours: 2
- Parallel: true (can run alongside payment tests)

## Definition of Done
- [ ] Manual B2C invoice test passed
- [ ] Automatic invoice test passed (or documented why skipped)
- [ ] B2B invoice test passed
- [ ] All ECPay API calls successful
- [ ] Screenshots captured for each test case
- [ ] Test results documented
