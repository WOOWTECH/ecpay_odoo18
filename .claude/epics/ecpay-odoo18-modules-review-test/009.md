---
name: Integration Test - Full Purchase Flow
status: open
created: 2025-12-30T11:11:52Z
updated: 2025-12-30T11:11:52Z
github: [Will be updated when synced to GitHub]
depends_on: [003, 004, 005, 006, 007, 008]
parallel: false
conflicts_with: []
---

# Task: Integration Test - Full Purchase Flow

## Description
Execute comprehensive end-to-end integration tests combining website checkout, payment processing, and electronic invoice generation in complete purchase flows.

## Acceptance Criteria
- [ ] Complete purchase flow with credit card + auto invoice works
- [ ] Complete purchase flow with ATM + manual invoice works
- [ ] Website checkout with invoice options + payment works
- [ ] Order status, payment status, invoice status all correct
- [ ] Screenshots captured for entire flow
- [ ] Any issues documented with reproduction steps

## Technical Details

### Integration Test 1: Credit Card + Auto Invoice
**Scenario:** Customer purchases with credit card, automatic invoice generation

1. **Website Flow:**
   - Login as test user
   - Add product to cart
   - Proceed to checkout
   - Select mobile barcode carrier
   - Enter valid barcode
   - Select ECPay credit card payment

2. **Payment Flow:**
   - Redirect to ECPay
   - Complete test credit card payment
   - Return to Odoo

3. **Verification:**
   - Sale order confirmed
   - Payment transaction = 'done'
   - Invoice created automatically
   - E-invoice created with carrier info
   - Customer receives confirmation

### Integration Test 2: ATM + Manual Invoice
**Scenario:** Customer pays via ATM, admin manually creates invoice

1. **Website Flow:**
   - Add product to cart
   - Select print invoice
   - Enter company tax ID
   - Select ATM payment

2. **Payment Flow:**
   - Get ATM virtual account
   - Simulate payment confirmation

3. **Admin Flow:**
   - View sale order in backend
   - Create invoice
   - Post invoice
   - Manually create e-invoice
   - Verify B2B invoice created

### Integration Test 3: Donation Flow
**Scenario:** Customer donates invoice to charity

1. **Website Flow:**
   - Add product to cart
   - Select donation option
   - Enter love code
   - Complete payment

2. **Verification:**
   - Invoice created with donation flag
   - Love code set correctly
   - No print flag

### Integration Test 4: Multi-Product Order
**Scenario:** Order with multiple products

1. Add 3 different products to cart
2. Complete checkout with invoice options
3. Verify:
   - All products in invoice
   - ItemName contains all products (separated by #)
   - Total amount correct

### Integration Test 5: Error Recovery
**Scenario:** Test error handling

1. Try checkout with invalid mobile barcode
2. Verify validation error shown
3. Fix and continue
4. Try checkout with payment failure
5. Verify error message
6. Retry payment

### State Verification Checklist
| Entity | Expected State |
|--------|---------------|
| Sale Order | `sale` (confirmed) |
| Payment Transaction | `done` |
| Account Move (Invoice) | `posted` |
| Uniform Invoice | Created with number |
| uniform_state | `invoiced` |

### Test Data Requirements
- Test products with prices
- Test customer account
- Valid mobile barcode for testing
- Valid love code for testing

## Dependencies
- [ ] Task 003-005: Invoice module fully tested
- [ ] Task 006-007: Payment module fully tested
- [ ] Task 008: Website module fully tested

## Effort Estimate
- Size: L
- Hours: 3
- Parallel: false (final integration)

## Definition of Done
- [ ] Credit card + auto invoice flow passed
- [ ] ATM + manual invoice flow passed
- [ ] Donation flow passed
- [ ] Multi-product order passed
- [ ] Error recovery tested
- [ ] All states verified correct
- [ ] Screenshots captured for complete flows
- [ ] Test results documented
- [ ] Issues found documented with steps to reproduce
