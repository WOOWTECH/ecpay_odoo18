---
name: Website Module - Checkout Invoice Options Tests
status: open
created: 2025-12-30T11:11:52Z
updated: 2025-12-30T11:11:52Z
github: [Will be updated when synced to GitHub]
depends_on: [003, 004]
parallel: false
conflicts_with: []
---

# Task: Website Module - Checkout Invoice Options Tests

## Description
Test the website checkout invoice options provided by ecpay_invoice_website module, including carrier type selection, mobile barcode input, love code input, and business identifier input.

## Acceptance Criteria
- [ ] Invoice options visible on checkout page
- [ ] Carrier type selection works
- [ ] Mobile barcode input and validation works
- [ ] Love code input and validation works
- [ ] Business identifier (統一編號) input works
- [ ] Invoice data passed to backend correctly
- [ ] Screenshots captured for each option

## Technical Details

### Test Case 1: Invoice Options Display
1. Add product to cart
2. Proceed to checkout
3. Verify invoice options section visible
4. Check all carrier type options available:
   - ECPay carrier (綠界科技電子發票載具)
   - Certificate barcode (自然人憑證)
   - Mobile barcode (手機條碼)
   - Print invoice
   - Donation

### Test Case 2: Mobile Barcode Selection
1. Select "手機條碼" carrier type
2. Enter mobile barcode (e.g., `/ABC+123`)
3. Trigger validation (blur/submit)
4. Verify validation API called
5. Verify field accepts valid format
6. Test invalid format rejection

### Test Case 3: Love Code (Donation)
1. Select donation option
2. Enter love code (e.g., `168`)
3. Trigger validation
4. Verify love code validation API called
5. Verify valid love code accepted
6. Test invalid code rejection

### Test Case 4: Business Identifier (B2B)
1. Select B2B invoice option
2. Enter 統一編號 (e.g., `12345678`)
3. Enter company name (抬頭)
4. Verify fields visible and editable
5. Complete checkout

### Test Case 5: Print Invoice with Address
1. Select print invoice option
2. Enter delivery address
3. Verify address field visible
4. Complete checkout
5. Verify address stored on invoice

### Test Case 6: End-to-End with Invoice Options
1. Add product to cart
2. Select mobile barcode carrier
3. Enter valid barcode
4. Complete checkout with payment
5. Verify invoice created with correct carrier

### Frontend Files
- `views/website_sale.xml` - Checkout page template
- `static/src/js/invoice.js` - Validation JavaScript
- `static/src/scss/invoice.scss` - Styling

### Data Flow
```
Checkout Form → JavaScript Validation → Backend Controller → Sale Order Fields → Invoice Fields
```

### Fields Passed to Backend
- `carrierType` - Carrier type selection
- `carrierNum` - Carrier number (mobile barcode)
- `is_donation` - Donation flag
- `lovecode` - Love code for donation
- `ecpay_CustomerIdentifier` - Business tax ID
- `ec_ident_name` - Business name
- `is_print` - Print invoice flag
- `ec_print_address` - Invoice delivery address

## Dependencies
- [ ] Task 003: Basic invoice creation working
- [ ] Task 004: Carrier types working

## Effort Estimate
- Size: L
- Hours: 2
- Parallel: false (depends on invoice tests)

## Definition of Done
- [ ] Invoice options displayed correctly
- [ ] All carrier types selectable
- [ ] Mobile barcode validation working
- [ ] Love code validation working
- [ ] Business identifier input working
- [ ] Print address input working
- [ ] End-to-end test passed
- [ ] Screenshots captured
- [ ] Test results documented
