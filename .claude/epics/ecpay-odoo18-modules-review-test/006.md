---
name: Payment Module - Payment Flow Tests
status: open
created: 2025-12-30T11:11:52Z
updated: 2025-12-30T11:11:52Z
github: [Will be updated when synced to GitHub]
depends_on: [002]
parallel: true
conflicts_with: [003]
---

# Task: Payment Module - Payment Flow Tests

## Description
Test ECPay payment provider flows including credit card payment, ATM virtual account, CVS convenience store code, and barcode generation.

## Acceptance Criteria
- [ ] Credit card payment redirects to ECPay correctly
- [ ] ATM virtual account generated successfully
- [ ] CVS payment code generated successfully
- [ ] Barcode payment generated successfully
- [ ] Transaction records created with correct status
- [ ] Screenshots captured for each payment method

## Technical Details

### Test Case 1: Credit Card Payment Flow
1. Add product to cart on website
2. Proceed to checkout
3. Select ECPay payment provider
4. Choose credit card payment
5. Redirect to ECPay payment page
6. Verify redirect URL parameters correct
7. Verify MerchantTradeNo format
8. Screenshot ECPay payment page

### Test Case 2: ATM Virtual Account
1. Checkout with ATM payment method
2. Verify redirect to ECPay
3. Get virtual account number
4. Verify transaction status = 'pending'
5. Check expiration date correct (default 3 days)
6. Screenshot payment info page

### Test Case 3: CVS Convenience Store Code
1. Checkout with CVS payment method
2. Verify redirect to ECPay
3. Get payment code
4. Verify transaction status = 'pending'
5. Check expiration (default 7 days = 10080 minutes)
6. Screenshot payment code

### Test Case 4: Barcode Payment
1. Checkout with barcode payment method
2. Verify redirect to ECPay
3. Get barcode for printing
4. Verify transaction status = 'pending'
5. Check expiration (default 7 days)
6. Screenshot barcode

### Payment Method Codes
- `Credit` - Credit card
- `ATM` - Virtual account
- `CVS` - Convenience store code
- `BARCODE` - Barcode payment
- `ALL` - Show all options

### Transaction States
- `draft` - Initial state
- `pending` - Waiting for payment (ATM/CVS/Barcode)
- `done` - Payment completed
- `error` - Payment failed

### API Parameters to Verify
- `MerchantID` - Correct test merchant
- `MerchantTradeNo` - Unique order number
- `TotalAmount` - Correct order amount
- `ReturnURL` - Callback URL
- `OrderResultURL` - Return URL after payment
- `ChoosePayment` - Selected payment method

## Dependencies
- [ ] Task 002: Payment provider configured

## Effort Estimate
- Size: L
- Hours: 3
- Parallel: true (can run alongside invoice tests)

## Definition of Done
- [ ] Credit card flow tested
- [ ] ATM flow tested
- [ ] CVS flow tested
- [ ] Barcode flow tested
- [ ] All transaction records created correctly
- [ ] Screenshots captured for each flow
- [ ] Test results documented
