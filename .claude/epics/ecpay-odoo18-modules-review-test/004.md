---
name: Invoice Module - Carrier Types & Donation Tests
status: open
created: 2025-12-30T11:11:52Z
updated: 2025-12-30T11:11:52Z
github: [Will be updated when synced to GitHub]
depends_on: [003]
parallel: false
conflicts_with: []
---

# Task: Invoice Module - Carrier Types & Donation Tests

## Description
Test electronic invoice carrier types (載具) including mobile barcode (手機條碼), certificate barcode (自然人憑證), and donation (捐贈) functionality with love code (愛心碼).

## Acceptance Criteria
- [ ] Mobile barcode carrier validation works
- [ ] Invoice with mobile barcode carrier creates successfully
- [ ] Certificate barcode carrier works
- [ ] Love code validation works
- [ ] Donation invoice creates successfully
- [ ] Print invoice option works
- [ ] Screenshots captured for each test

## Technical Details

### Test Case 1: Mobile Barcode Carrier (手機條碼)
1. Create invoice with:
   - `carrierType = '3'` (手機條碼)
   - `carrierNum = '/ABC+123'` (example format)
   - `is_print = False`
2. Validate barcode via ECPay API (CheckBarcode)
3. Create e-invoice
4. Verify IIS_Carrier_Type = '3'

**Mobile Barcode Format:** `/` followed by 7 alphanumeric characters

### Test Case 2: Certificate Barcode (自然人憑證)
1. Create invoice with:
   - `carrierType = '2'` (自然人憑證)
   - `carrierNum = 'XX12345678901234'` (16 chars)
   - `is_print = False`
2. Create e-invoice
3. Verify IIS_Carrier_Type = '2'

### Test Case 3: Donation with Love Code (愛心碼)
1. Get a valid love code (e.g., '168' for 創世基金會)
2. Validate via ECPay API (CheckLoveCode)
3. Create invoice with:
   - `is_donation = True`
   - `lovecode = '168'`
   - `is_print = False`
4. Create e-invoice
5. Verify Donation = '1' in invoice

### Test Case 4: Print Invoice
1. Create invoice with:
   - `is_print = True`
   - No carrier
2. Create e-invoice
3. Verify IIS_Print_Flag = '1'
4. Verify customer address included

### ECPay API Endpoints Used
- `B2CInvoice/CheckBarcode` - Validate mobile barcode
- `B2CInvoice/CheckLoveCode` - Validate love code
- `B2CInvoice/Issue` - Create invoice

### Validation Rules
- Print + Donation = Error (mutually exclusive)
- Print + Carrier = Error
- Carrier Type 2/3 requires carrierNum

## Dependencies
- [ ] Task 003: Basic invoice creation working

## Effort Estimate
- Size: M
- Hours: 2
- Parallel: false (depends on Task 003)

## Definition of Done
- [ ] Mobile barcode validation tested
- [ ] Mobile barcode invoice created
- [ ] Certificate barcode invoice created
- [ ] Love code validation tested
- [ ] Donation invoice created
- [ ] Print invoice created
- [ ] All validation rules verified
- [ ] Screenshots captured
- [ ] Test results documented
